<!--
  ~ KKuTu-Web (https://github.com/KKuTuIO/KKuTu-Web)
  ~ Copyright (C) 2021 KKuTuIO <admin@kkutu.io>
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- @formatter:off -->
    <!-- @formatter:on -->
    <title th:text="#{title}"></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <script
            src="https://browser.sentry-cdn.com/6.2.5/bundle.min.js"
            integrity="sha384-+0tgGyP4idWu9/NA6Jbmnj3SApxIg65/GR1zo3qSieRNyzmmDQ/5a1Yu6mfmUw+v"
            crossorigin="anonymous"
    ></script>
    <script
            src="https://browser.sentry-cdn.com/6.2.5/bundle.tracing.min.js"
            integrity="sha384-xd/W0P7puokZpoEqk4srLDzK5R0WV2B2IZVlA0T4MEU4Fojxk+o+5KF6u43wkTL6"
            crossorigin="anonymous"
    ></script>

    <link rel="canonical" th:href="@{'https://kkutu.io' + ${#httpServletRequest.requestURI}}">
    <meta name="description" th:content="#{meta.description}">
    <meta name="keywords" th:content="#{meta.keywords}">

    <meta property="og:image" th:content="#{og.image}">
    <meta property="og:url" th:content="@{/}">
    <meta property="og:title" th:content="#{og.title}">
    <meta property="og:description" th:content="#{og.description}">

    <link rel="stylesheet" th:href="@{'https://cdn.kkutu.io/css/style.css?rv=' + ${runnerVersion}}"/>
    <link rel="stylesheet" href="https://cdn.kkutu.io/css/fontawesome-free-6.5.2-web/css/fontawesome.min.css"/>
    <link rel="stylesheet" href="https://cdn.kkutu.io/css/fontawesome-free-6.5.2-web/css/solid.min.css"/>
    <link rel="stylesheet" href="https://cdn.kkutu.io/css/fontawesome-free-6.5.2-web/css/regular.min.css"/>
    <link rel="stylesheet" th:href="@{'https://cdn.kkutu.io/css/expl.css?rv=' + ${runnerVersion}}"/>
    <link rel="manifest" href="manifest.json">

    <link rel="icon" type="image/x-icon" href="https://cdn.kkutu.io/favicon.ico?v=3.7">

    <script type="text/javascript" th:inline="javascript" nonce="HhKDLdJS4bHMDv6V">
        var loginProfile = /*[[${profile}]]*/'';
        var Messages = /*[[${messages}]]*/{};
        var GoodDetails = /*[[${goodDetails}]]*/{};

        if (window.hasOwnProperty('Sentry')) {
            Sentry.init({
                dsn: "https://b9922bdaf73941ac859ad944856931ba@o1271663.ingest.sentry.io/6464251",
                environment: "production", // production
                release: "kkutu-web-frontend@1.1.1",
                integrations: [new Sentry.Integrations.BrowserTracing()],
                ignoreErrors: ["syncClientInfo", "TurnstileError", "decodeAudioData", "importError"],

                // We recommend adjusting this value in production, or using tracesSampler
                // for finer control
                tracesSampleRate: 1.0,
            });

            if (loginProfile !== 'null') {
                var loginProfileJson = JSON.parse(loginProfile);
                Sentry.setUser({
                    id: loginProfileJson.id,
                    username: loginProfileJson.title,
                    ip_address: '{{auto}}'
                });
            }
        } else {
            console.warn('AdBlock 등의 원인으로 오류 로그 수집기를 로드하지 못했습니다.');
        }

        function getObject(v, i) {
            Object.defineProperty(v, i, {value: v[i], writable: false});
        }

        getObject(window.WebSocket, "send");
        getObject(window.WebSocket, "onmessage");
        getObject(window, "WebSocket");

        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PBFPQKD');

        if ('serviceWorker' in navigator) {
            window.addEventListener("load", function() {
                navigator.serviceWorker.register('https://kkutu.io/js/pwa-service-worker.js').then(function() {
                    console.log('ServiceWorker 등록됨');
                });
            });
        }
    </script>
    <script src="https://cdn.kkutu.io/js/jquery.min.js?version=1.12.4" type="text/javascript"></script>
    <script type="text/javascript" src="https://cdn.kkutu.io/js/global.min.js?version=3.8.0"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4370279749446514" crossorigin="anonymous"></script>
    </head>
<body style="min-width: 640px;">
<!-- @formatter:off -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe height="0"
                  src="https://www.googletagmanager.com/ns.html?id=GTM-PBFPQKD" style="display:none;visibility:hidden" width="0"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<!-- @formatter:on -->
<div id="Top" th:unless="${#strings.startsWith(viewName, 'view/login')}">
    <div th:include="menu" th:remove="tag"></div>
    <div id="global-notice">
        <div id="gn-content"></div>
    </div>
</div>

<div id="Jungle">
    <span id="mobile" th:text="${mobile}"></span>
    <div id="Background"></div>

    <th:block th:if="${viewName == 'view/kkutu/kkutu' || viewName == 'view/kkutu/m_kkutu'}">
        <div id="Yell"></div>
        <div id="Loading" th:text="#{kkutu.loading}"></div>
        <div id="Balloons" style="position: absolute;"></div>
    </th:block>
</div>

<div id="Middle" th:include="${viewName}"></div>

<div id="Bottom" th:unless="${#strings.startsWith(viewName, 'view/login')}">
    <div class="bottom-legal" th:utext="#{legal.copyright}"></div>
    <div style="float: left; width: 100%; margin: 10px 0;"></div>
</div>
</body>
</html>